jQuery(function(a){"use strict";a(document).on('change','.wt_give_away_product_attr',function(){var b=a(this).closest('.wt_get_away_product'),c={},d,e;if(b.find('.wt_give_away_product_attr').each(function(b){c[a(this).attr('data-attribute_name')]=a(this).val()}),""==a(this).val())return b.find('input[name="variation_id"]').val(0),b.find('input[name="wt_variation_options"]').val(JSON.stringify(c)),!1;d=b.attr('product-id'),e={action:'update_variation_id',attributes:c,product:d,_wpnonce:WTSmartCouponOBJ.nonces.public},a('.wt_choose_free_product, .wt_add_to_cart_all_btn, .checkout-button').prop('disabled',!0).css({opacity:.5,cursor:'not-allowed'}),a('.wt_get_away_product').css({opacity:.5,cursor:'wait'}),jQuery.ajax({type:"POST",async:!0,url:WTSmartCouponOBJ.ajaxurl,data:e,dataType:'json',success:function(d){a('.wt_choose_free_product, .wt_add_to_cart_all_btn, .checkout-button').prop('disabled',!1).css({opacity:1,cursor:'pointer'}),a('.wt_get_away_product').css({opacity:1,cursor:'default'}),d.status==!0?(b.find('input[name="variation_id"]').val(d.variation_id),b.find('input[name="wt_variation_options"]').val(JSON.stringify(c))):(b.find('input[name="variation_id"]').val(0),alert(d.status_msg))},error:function(){b.find('input[name="variation_id"]').val(0),a('.wt_choose_free_product, .wt_add_to_cart_all_btn, .checkout-button').prop('disabled',!1).css({opacity:1,cursor:'pointer'}),a('.wt_get_away_product').css({opacity:1,cursor:'default'}),alert(WTSmartCouponOBJ.labels.error)}})}),a(document).on('click','.wt_add_to_cart_all_btn',function(j){var f,h,c,g,d,e,i;if(j.preventDefault(),f=a(this).attr('coupon-id'),h=a('.wt_give_away_products[coupon="'+f+'"]'),c=new Array,g=new Array,d=new Array,e=!1,h.find('.wt_get_away_product').each(function(){var b,f;if(a(this).attr('data-is_purchasable')==1){if(b=a(this).find('[name="variation_id"]'),b.length>0){if(b.val().trim()==""||b.val().trim()=="0")return alert(WTSmartCouponOBJ.labels.choose_variation),e=!0,!1;c.push(b.val()),d.push(JSON.parse(a(this).find('[name="wt_variation_options"]').val()))}else c.push(0),d.push([]);f=a(this).attr('product-id'),g.push(f)}}),e===!0)return!1;i={action:'wt_choose_free_product',_wpnonce:WTSmartCouponOBJ.nonces.public,product_id:0,variation_id:0,attributes:d,coupon_id:f,product_id_arr:g,variation_id_arr:c,add_to_cart_all:1},b(a(this),i)});function b(b,e){var d=b.html(),c;b.html(WTSmartCouponOBJ.labels.please_wait),c=a('.wt_add_to_cart_all_btn, .wt_choose_free_product'),c.prop('disabled',!0),a('.woocommerce-notices-wrapper').length||a('#main').prepend('<div class="woocommerce-notices-wrapper"></div>'),a('.woocommerce-notices-wrapper').html(''),jQuery.ajax({type:"POST",async:!0,url:WTSmartCouponOBJ.ajaxurl,data:e,success:function(e){e=='success'?location.reload():(a('.woocommerce-notices-wrapper').html(e),a("html, body").stop(!0,!0).animate({scrollTop:a('.woocommerce-notices-wrapper').offset().top-70},500),b.html(d),c.prop('disabled',!1))},error:function(){b.html(d),c.prop('disabled',!1)}})}a(document).on('click','.wt_choose_free_product',function(j){var c,e,d,f,g,h,i;if(j.preventDefault(),c=a(this).closest('.wt_get_away_product'),c.attr('data-is_purchasable')==1){if(e=0,d=c.find('[name="variation_id"]'),d.length>0){if(d.val().trim()==""||d.val().trim()=="0")return alert(WTSmartCouponOBJ.labels.choose_variation),!1;e=d.val()}if(f=a(this).closest('.wt_give_away_products').attr('coupon'),typeof f=='undefined')return!1;if(g=a(this).attr('prod-id'),typeof g=='undefined')return!1;h=c.find('input[name="wt_variation_options"]').length>0?JSON.parse(c.find('input[name="wt_variation_options"]').val()):'',i={action:'wt_choose_free_product',_wpnonce:WTSmartCouponOBJ.nonces.public,product_id:g,variation_id:e,attributes:h,coupon_id:f},b(a(this),i)}})})